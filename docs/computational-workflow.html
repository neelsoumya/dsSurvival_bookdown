<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Computational workflow | dsSurvival: Privacy preserving survival models in DataSHIELD</title>
  <meta name="description" content="This is a bookdown demonstrating how to build privacy preserving survival models using dsSurvival in DataSHIELD. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Computational workflow | dsSurvival: Privacy preserving survival models in DataSHIELD" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a bookdown demonstrating how to build privacy preserving survival models using dsSurvival in DataSHIELD. The output format for this example is bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Computational workflow | dsSurvival: Privacy preserving survival models in DataSHIELD" />
  
  <meta name="twitter:description" content="This is a bookdown demonstrating how to build privacy preserving survival models using dsSurvival in DataSHIELD. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="Soumya Banerjee and Tom R P Bishop" />


<meta name="date" content="2022-01-06" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="intro.html"/>
<link rel="next" href="summary.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Prerequisites</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#survival-models"><i class="fa fa-check"></i><b>2.1</b> Survival models</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="computational-workflow.html"><a href="computational-workflow.html"><i class="fa fa-check"></i><b>3</b> Computational workflow</a>
<ul>
<li class="chapter" data-level="3.1" data-path="computational-workflow.html"><a href="computational-workflow.html#creating-server-side-variables-for-survival-analysis"><i class="fa fa-check"></i><b>3.1</b> Creating server-side variables for survival analysis</a></li>
<li class="chapter" data-level="3.2" data-path="computational-workflow.html"><a href="computational-workflow.html#create-survival-object-and-call-ds.coxph.slma"><i class="fa fa-check"></i><b>3.2</b> Create survival object and call ds.coxph.SLMA()</a></li>
<li class="chapter" data-level="3.3" data-path="computational-workflow.html"><a href="computational-workflow.html#diagnostics-for-cox-proportional-hazards-models"><i class="fa fa-check"></i><b>3.3</b> Diagnostics for Cox proportional hazards models</a></li>
<li class="chapter" data-level="3.4" data-path="computational-workflow.html"><a href="computational-workflow.html#summary-of-survival-objects"><i class="fa fa-check"></i><b>3.4</b> Summary of survival objects</a></li>
<li class="chapter" data-level="3.5" data-path="computational-workflow.html"><a href="computational-workflow.html#meta-analyze-hazard-ratios"><i class="fa fa-check"></i><b>3.5</b> Meta-analyze hazard ratios</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="summary.html"><a href="summary.html"><i class="fa fa-check"></i><b>4</b> Summary</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">dsSurvival: Privacy preserving survival models in DataSHIELD</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="computational-workflow" class="section level1" number="3">
<h1><span class="header-section-number">Chapter 3</span> Computational workflow</h1>
<p>The computational steps are outlined below.
The first step is connecting to the server and loading the survival data.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="computational-workflow.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb2-2"><a href="computational-workflow.html#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rmarkdown)</span>
<span id="cb2-3"><a href="computational-workflow.html#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tinytex)</span>
<span id="cb2-4"><a href="computational-workflow.html#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb2-5"><a href="computational-workflow.html#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(metafor)</span>
<span id="cb2-6"><a href="computational-workflow.html#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb2-7"><a href="computational-workflow.html#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dsSurvivalClient)</span>
<span id="cb2-8"><a href="computational-workflow.html#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(<span class="st">&#39;DSI&#39;</span>)</span>
<span id="cb2-9"><a href="computational-workflow.html#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(<span class="st">&#39;DSOpal&#39;</span>)</span>
<span id="cb2-10"><a href="computational-workflow.html#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(<span class="st">&#39;dsBaseClient&#39;</span>)</span>
<span id="cb2-11"><a href="computational-workflow.html#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="computational-workflow.html#cb2-12" aria-hidden="true" tabindex="-1"></a>builder <span class="ot">&lt;-</span> DSI<span class="sc">::</span><span class="fu">newDSLoginBuilder</span>()</span>
<span id="cb2-13"><a href="computational-workflow.html#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="computational-workflow.html#cb2-14" aria-hidden="true" tabindex="-1"></a>builder<span class="sc">$</span><span class="fu">append</span>(<span class="at">server=</span><span class="st">&quot;server1&quot;</span>, <span class="at">url=</span><span class="st">&quot;https://opal-sandbox.mrc-epid.cam.ac.uk&quot;</span>,</span>
<span id="cb2-15"><a href="computational-workflow.html#cb2-15" aria-hidden="true" tabindex="-1"></a>                <span class="at">user=</span><span class="st">&quot;dsuser&quot;</span>, <span class="at">password=</span><span class="st">&quot;P@ssw0rd&quot;</span>, </span>
<span id="cb2-16"><a href="computational-workflow.html#cb2-16" aria-hidden="true" tabindex="-1"></a>               <span class="at">table =</span> <span class="st">&quot;SURVIVAL.EXPAND_NO_MISSING1&quot;</span>)</span>
<span id="cb2-17"><a href="computational-workflow.html#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="computational-workflow.html#cb2-18" aria-hidden="true" tabindex="-1"></a>builder<span class="sc">$</span><span class="fu">append</span>(<span class="at">server=</span><span class="st">&quot;server2&quot;</span>, <span class="at">url=</span><span class="st">&quot;https://opal-sandbox.mrc-epid.cam.ac.uk&quot;</span>,</span>
<span id="cb2-19"><a href="computational-workflow.html#cb2-19" aria-hidden="true" tabindex="-1"></a>               <span class="at">user=</span><span class="st">&quot;dsuser&quot;</span>, <span class="at">password=</span><span class="st">&quot;P@ssw0rd&quot;</span>, </span>
<span id="cb2-20"><a href="computational-workflow.html#cb2-20" aria-hidden="true" tabindex="-1"></a>               <span class="at">table =</span> <span class="st">&quot;SURVIVAL.EXPAND_NO_MISSING2&quot;</span>)</span>
<span id="cb2-21"><a href="computational-workflow.html#cb2-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-22"><a href="computational-workflow.html#cb2-22" aria-hidden="true" tabindex="-1"></a>builder<span class="sc">$</span><span class="fu">append</span>(<span class="at">server=</span><span class="st">&quot;server3&quot;</span>, <span class="at">url=</span><span class="st">&quot;https://opal-sandbox.mrc-epid.cam.ac.uk&quot;</span>,</span>
<span id="cb2-23"><a href="computational-workflow.html#cb2-23" aria-hidden="true" tabindex="-1"></a>               <span class="at">user=</span><span class="st">&quot;dsuser&quot;</span>, <span class="at">password=</span><span class="st">&quot;P@ssw0rd&quot;</span>, </span>
<span id="cb2-24"><a href="computational-workflow.html#cb2-24" aria-hidden="true" tabindex="-1"></a>               <span class="at">table =</span> <span class="st">&quot;SURVIVAL.EXPAND_NO_MISSING3&quot;</span>)          </span>
<span id="cb2-25"><a href="computational-workflow.html#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="computational-workflow.html#cb2-26" aria-hidden="true" tabindex="-1"></a>logindata <span class="ot">&lt;-</span> builder<span class="sc">$</span><span class="fu">build</span>()</span>
<span id="cb2-27"><a href="computational-workflow.html#cb2-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-28"><a href="computational-workflow.html#cb2-28" aria-hidden="true" tabindex="-1"></a>connections <span class="ot">&lt;-</span> DSI<span class="sc">::</span><span class="fu">datashield.login</span>(<span class="at">logins =</span> logindata, <span class="at">assign =</span> <span class="cn">TRUE</span>, <span class="at">symbol =</span> <span class="st">&quot;D&quot;</span>) </span></code></pre></div>
<div id="creating-server-side-variables-for-survival-analysis" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Creating server-side variables for survival analysis</h2>
<p>We now outline the steps for analysing survival data.</p>
<p>We show this using synthetic data. There are 3 data sets that are held on the same server but can be considered to be on separate servers/sites.</p>
<p>The <strong>cens</strong> variable has the event information and the <strong>survtime</strong> variable has the time information. There is also age and gender information in the variables named <strong>age</strong> and <strong>female</strong>, respectively.</p>
<p>We will look at how age and gender affect survival time and then meta-analyze the hazard ratios from the survival model.</p>
<ul>
<li>make sure that the outcome variable is numeric</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="computational-workflow.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.asNumeric</span>(<span class="at">x.name =</span> <span class="st">&quot;D$cens&quot;</span>,</span>
<span id="cb3-2"><a href="computational-workflow.html#cb3-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">newobj =</span> <span class="st">&quot;EVENT&quot;</span>,</span>
<span id="cb3-3"><a href="computational-workflow.html#cb3-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">datasources =</span> connections)</span>
<span id="cb3-4"><a href="computational-workflow.html#cb3-4" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb3-5"><a href="computational-workflow.html#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.asNumeric</span>(<span class="at">x.name =</span> <span class="st">&quot;D$survtime&quot;</span>,</span>
<span id="cb3-6"><a href="computational-workflow.html#cb3-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">newobj =</span> <span class="st">&quot;SURVTIME&quot;</span>,</span>
<span id="cb3-7"><a href="computational-workflow.html#cb3-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">datasources =</span> connections)</span></code></pre></div>
<ul>
<li>convert time id variable to a factor</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="computational-workflow.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.asFactor</span>(<span class="at">input.var.name =</span> <span class="st">&quot;D$time.id&quot;</span>,</span>
<span id="cb4-2"><a href="computational-workflow.html#cb4-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">newobj =</span> <span class="st">&quot;TID&quot;</span>,</span>
<span id="cb4-3"><a href="computational-workflow.html#cb4-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">datasources =</span> connections)</span></code></pre></div>
<ul>
<li>create in the server-side the log(survtime) variable</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="computational-workflow.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.log</span>(<span class="at">x =</span> <span class="st">&quot;D$survtime&quot;</span>,</span>
<span id="cb5-2"><a href="computational-workflow.html#cb5-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">newobj =</span> <span class="st">&quot;log.surv&quot;</span>,</span>
<span id="cb5-3"><a href="computational-workflow.html#cb5-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">datasources =</span> connections)</span></code></pre></div>
<ul>
<li>create start time variable</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="computational-workflow.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.asNumeric</span>(<span class="at">x.name =</span> <span class="st">&quot;D$starttime&quot;</span>,</span>
<span id="cb6-2"><a href="computational-workflow.html#cb6-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">newobj =</span> <span class="st">&quot;STARTTIME&quot;</span>,</span>
<span id="cb6-3"><a href="computational-workflow.html#cb6-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">datasources =</span> connections)</span>
<span id="cb6-4"><a href="computational-workflow.html#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.asNumeric</span>(<span class="at">x.name =</span> <span class="st">&quot;D$endtime&quot;</span>,</span>
<span id="cb6-5"><a href="computational-workflow.html#cb6-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">newobj =</span> <span class="st">&quot;ENDTIME&quot;</span>,</span>
<span id="cb6-6"><a href="computational-workflow.html#cb6-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">datasources =</span> connections)</span></code></pre></div>
</div>
<div id="create-survival-object-and-call-ds.coxph.slma" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Create survival object and call ds.coxph.SLMA()</h2>
<p>There are two options to generate the survival object. You can generate it separately or in line.</p>
<p>If a survival object is generated separately, it is stored on the server and can be used later in an assign function ( ds.coxphSLMAassign() ). The motivation for creating the model on the server side is inspired from the ds.glmassign functions. This allows the survival model to be stored on the server and can be used later for diagnostics.</p>
<ul>
<li>use constructed Surv object in <em>ds.coxph.SLMA()</em></li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="computational-workflow.html#cb7-1" aria-hidden="true" tabindex="-1"></a>dsSurvivalClient<span class="sc">::</span><span class="fu">ds.Surv</span>(<span class="at">time=</span><span class="st">&#39;STARTTIME&#39;</span>, <span class="at">time2=</span><span class="st">&#39;ENDTIME&#39;</span>, </span>
<span id="cb7-2"><a href="computational-workflow.html#cb7-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">event =</span> <span class="st">&#39;EVENT&#39;</span>, <span class="at">objectname=</span><span class="st">&#39;surv_object&#39;</span>,</span>
<span id="cb7-3"><a href="computational-workflow.html#cb7-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">type=</span><span class="st">&#39;counting&#39;</span>)</span>
<span id="cb7-4"><a href="computational-workflow.html#cb7-4" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb7-5"><a href="computational-workflow.html#cb7-5" aria-hidden="true" tabindex="-1"></a>coxph_model_full <span class="ot">&lt;-</span> dsSurvivalClient<span class="sc">::</span><span class="fu">ds.coxph.SLMA</span>(<span class="at">formula =</span> <span class="st">&#39;surv_object~D$age+D$female&#39;</span>)</span></code></pre></div>
<ul>
<li>use direct inline call to <em>survival::Surv()</em></li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="computational-workflow.html#cb8-1" aria-hidden="true" tabindex="-1"></a>dsSurvivalClient<span class="sc">::</span><span class="fu">ds.coxph.SLMA</span>(<span class="at">formula =</span> <span class="st">&#39;survival::Surv(time=SURVTIME,event=EVENT)~D$age+D$female&#39;</span>, </span>
<span id="cb8-2"><a href="computational-workflow.html#cb8-2" aria-hidden="true" tabindex="-1"></a>                                <span class="at">dataName =</span> <span class="st">&#39;D&#39;</span>, </span>
<span id="cb8-3"><a href="computational-workflow.html#cb8-3" aria-hidden="true" tabindex="-1"></a>                                <span class="at">datasources =</span> connections)</span></code></pre></div>
<ul>
<li>call with <em>survival::strata()</em></li>
</ul>
<p>The strata() option allows us to relax some of the proportional hazards assumptions. It allows fitting of a separate baseline hazard function within each strata.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="computational-workflow.html#cb9-1" aria-hidden="true" tabindex="-1"></a>coxph_model_strata <span class="ot">&lt;-</span> dsSurvivalClient<span class="sc">::</span><span class="fu">ds.coxph.SLMA</span>(<span class="at">formula =</span> <span class="st">&#39;surv_object~D$age + </span></span>
<span id="cb9-2"><a href="computational-workflow.html#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="st">                          survival::strata(D$female)&#39;</span>)</span>
<span id="cb9-3"><a href="computational-workflow.html#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(coxph_model_strata)</span></code></pre></div>
</div>
<div id="diagnostics-for-cox-proportional-hazards-models" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Diagnostics for Cox proportional hazards models</h2>
<p>We have also created functions to test for the assumptions of
Cox proportional hazards models. This requires a call to the function ds.cox.zphSLMA. Before the call, a server-side object has to be created using the assign function ds.coxphSLMAassign().</p>
<p>All the function calls are shown below:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="computational-workflow.html#cb10-1" aria-hidden="true" tabindex="-1"></a>dsSurvivalClient<span class="sc">::</span><span class="fu">ds.coxphSLMAassign</span>(<span class="at">formula =</span> <span class="st">&#39;surv_object~D$age+D$female&#39;</span>,</span>
<span id="cb10-2"><a href="computational-workflow.html#cb10-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">objectname =</span> <span class="st">&#39;coxph_serverside&#39;</span>)</span>
<span id="cb10-3"><a href="computational-workflow.html#cb10-3" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb10-4"><a href="computational-workflow.html#cb10-4" aria-hidden="true" tabindex="-1"></a>dsSurvivalClient<span class="sc">::</span><span class="fu">ds.cox.zphSLMA</span>(<span class="at">fit =</span> <span class="st">&#39;coxph_serverside&#39;</span>)</span>
<span id="cb10-5"><a href="computational-workflow.html#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="computational-workflow.html#cb10-6" aria-hidden="true" tabindex="-1"></a>dsSurvivalClient<span class="sc">::</span><span class="fu">ds.coxphSummary</span>(<span class="at">x =</span> <span class="st">&#39;coxph_serverside&#39;</span>)</span></code></pre></div>
<p>These diagnostics can allow an analyst to determine if the proportional hazards assumption in Cox proportional hazards models is satisfied. If the p-values shown below are greater than 0.05 for any co-variate, then the proportional hazards assumption is correct for that co-variate.</p>
<p>If the proportional hazards assumptions are violated (p-values less than 0.05), then the analyst will have to modify the model. Modifications may include introducing strata or using time-dependent covariates. Please see the links below for more information on this:</p>
<ul>
<li><p><a href="https://stats.stackexchange.com/questions/317336/interpreting-r-coxph-cox-zph" class="uri">https://stats.stackexchange.com/questions/317336/interpreting-r-coxph-cox-zph</a></p></li>
<li><p><a href="https://stats.stackexchange.com/questions/144923/extended-cox-model-and-cox-zph/238964#238964" class="uri">https://stats.stackexchange.com/questions/144923/extended-cox-model-and-cox-zph/238964#238964</a></p></li>
</ul>
<p>A diagnostic summary is shown below.</p>
<pre><code>## surv_object~D$age+D$female</code></pre>
<pre><code>## 
   [-------------------------------------------------------------------------------------]   0% / 0s
  Checking study1 (coxph_serverside &lt;- coxphSLMAassignDS(formula = surv_object ~ D$age + D$female...
  Checking study2 (coxph_serverside &lt;- coxphSLMAassignDS(formula = surv_object ~ D$age + D$female...
  Checking study3 (coxph_serverside &lt;- coxphSLMAassignDS(formula = surv_object ~ D$age + D$female...
  Waiting...  (coxph_serverside &lt;- coxphSLMAassignDS(formula = surv_object ~ D$age + D$female, NU...
  Checking study1 (coxph_serverside &lt;- coxphSLMAassignDS(formula = surv_object ~ D$age + D$female...
  Finalizing assignment study1 (coxph_serverside &lt;- coxphSLMAassignDS(formula = surv_object ~ D$a...
  Checking study2 (coxph_serverside &lt;- coxphSLMAassignDS(formula = surv_object ~ D$age + D$female...
  Finalizing assignment study2 (coxph_serverside &lt;- coxphSLMAassignDS(formula = surv_object ~ D$a...
  Checking study3 (coxph_serverside &lt;- coxphSLMAassignDS(formula = surv_object ~ D$age + D$female...
  Finalizing assignment study3 (coxph_serverside &lt;- coxphSLMAassignDS(formula = surv_object ~ D$a...
  Assigned expr. (coxph_serverside &lt;- coxphSLMAassignDS(formula = surv_object ~ D$age + D$female,...</code></pre>
<pre><code>## NULL</code></pre>
<pre><code>## 
   [-------------------------------------------------------------------------------------]   0% / 0s
  Checking study1 (cox.zphSLMADS(&quot;coxph_serverside&quot;, &quot;km&quot;, TRUE, FALSE, TRUE)) [---------]   0% / 0s
  Checking study2 (cox.zphSLMADS(&quot;coxph_serverside&quot;, &quot;km&quot;, TRUE, FALSE, TRUE)) [---------]   0% / 0s
  Checking study3 (cox.zphSLMADS(&quot;coxph_serverside&quot;, &quot;km&quot;, TRUE, FALSE, TRUE)) [---------]   0% / 0s
  Waiting...  (cox.zphSLMADS(&quot;coxph_serverside&quot;, &quot;km&quot;, TRUE, FALSE, TRUE)) [-------------]   0% / 0s
  Checking study1 (cox.zphSLMADS(&quot;coxph_serverside&quot;, &quot;km&quot;, TRUE, FALSE, TRUE)) [---------]   0% / 0s
  Getting aggregate study1 (cox.zphSLMADS(&quot;coxph_serverside&quot;, &quot;km&quot;, TRUE, FALSE, TRUE)) []  25% / 0s
  Checking study2 (cox.zphSLMADS(&quot;coxph_serverside&quot;, &quot;km&quot;, TRUE, FALSE, TRUE)) [=&gt;-------]  25% / 0s
  Getting aggregate study2 (cox.zphSLMADS(&quot;coxph_serverside&quot;, &quot;km&quot;, TRUE, FALSE, TRUE)) []  50% / 1s
  Checking study3 (cox.zphSLMADS(&quot;coxph_serverside&quot;, &quot;km&quot;, TRUE, FALSE, TRUE)) [===&gt;-----]  50% / 1s
  Getting aggregate study3 (cox.zphSLMADS(&quot;coxph_serverside&quot;, &quot;km&quot;, TRUE, FALSE, TRUE)) []  75% / 1s
  Aggregated (cox.zphSLMADS(&quot;coxph_serverside&quot;, &quot;km&quot;, TRUE, FALSE, TRUE)) [==============] 100% / 1s</code></pre>
<pre><code>## $study1
##          chisq df    p
## D$age    1.022  1 0.31
## D$female 0.364  1 0.55
## GLOBAL   1.239  2 0.54
## 
## $study2
##              chisq df    p
## D$age    -1389.472  1 1.00
## D$female     0.591  1 0.44
## GLOBAL    -857.492  2 1.00
## 
## $study3
##          chisq df       p
## D$age    15.27  1 9.3e-05
## D$female  8.04  1  0.0046
## GLOBAL   23.31  2 8.7e-06</code></pre>
<pre><code>## 
   [-------------------------------------------------------------------------------------]   0% / 0s
  Checking study1 (coxphSummaryDS(&quot;coxph_serverside&quot;)) [---------------------------------]   0% / 0s
  Checking study2 (coxphSummaryDS(&quot;coxph_serverside&quot;)) [---------------------------------]   0% / 0s
  Checking study3 (coxphSummaryDS(&quot;coxph_serverside&quot;)) [---------------------------------]   0% / 0s
  Waiting...  (coxphSummaryDS(&quot;coxph_serverside&quot;)) [-------------------------------------]   0% / 0s
  Checking study1 (coxphSummaryDS(&quot;coxph_serverside&quot;)) [---------------------------------]   0% / 0s
  Getting aggregate study1 (coxphSummaryDS(&quot;coxph_serverside&quot;)) [=====&gt;------------------]  25% / 0s
  Checking study2 (coxphSummaryDS(&quot;coxph_serverside&quot;)) [=======&gt;-------------------------]  25% / 1s
  Getting aggregate study2 (coxphSummaryDS(&quot;coxph_serverside&quot;)) [===========&gt;------------]  50% / 1s
  Checking study3 (coxphSummaryDS(&quot;coxph_serverside&quot;)) [===============&gt;-----------------]  50% / 1s
  Getting aggregate study3 (coxphSummaryDS(&quot;coxph_serverside&quot;)) [=================&gt;------]  75% / 1s
  Aggregated (coxphSummaryDS(&quot;coxph_serverside&quot;)) [======================================] 100% / 1s</code></pre>
<pre><code>## $study1
## Call:
## survival::coxph(formula = formula, data = dataTable, weights = weights, 
##     ties = ties, singular.ok = singular.ok, model = model, x = x, 
##     y = y)
## 
##   n= 2060, number of events= 426 
## 
##                coef exp(coef)  se(coef)      z
## D$age      0.041609  1.042487  0.003498 11.894
## D$female1 -0.660002  0.516850  0.099481 -6.634
##           Pr(&gt;|z|)    
## D$age      &lt; 2e-16 ***
## D$female1 3.26e-11 ***
## ---
## Signif. codes:  
## 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
##           exp(coef) exp(-coef) lower .95 upper .95
## D$age        1.0425     0.9592    1.0354    1.0497
## D$female1    0.5169     1.9348    0.4253    0.6281
## 
## Concordance= 0.676  (se = 0.014 )
## Likelihood ratio test= 170.7  on 2 df,   p=&lt;2e-16
## Wald test            = 168.2  on 2 df,   p=&lt;2e-16
## Score (logrank) test = 166.3  on 2 df,   p=&lt;2e-16
## 
## 
## $study2
## Call:
## survival::coxph(formula = formula, data = dataTable, weights = weights, 
##     ties = ties, singular.ok = singular.ok, model = model, x = x, 
##     y = y)
## 
##   n= 1640, number of events= 300 
## 
##               coef exp(coef) se(coef)      z Pr(&gt;|z|)
## D$age      0.04067   1.04151  0.00416  9.776  &lt; 2e-16
## D$female1 -0.62756   0.53389  0.11767 -5.333 9.66e-08
##              
## D$age     ***
## D$female1 ***
## ---
## Signif. codes:  
## 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
##           exp(coef) exp(-coef) lower .95 upper .95
## D$age        1.0415     0.9601    1.0331    1.0500
## D$female1    0.5339     1.8730    0.4239    0.6724
## 
## Concordance= 0.674  (se = 0.017 )
## Likelihood ratio test= 117.8  on 2 df,   p=&lt;2e-16
## Wald test            = 115.2  on 2 df,   p=&lt;2e-16
## Score (logrank) test = 116.4  on 2 df,   p=&lt;2e-16
## 
## 
## $study3
## Call:
## survival::coxph(formula = formula, data = dataTable, weights = weights, 
##     ties = ties, singular.ok = singular.ok, model = model, x = x, 
##     y = y)
## 
##   n= 2688, number of events= 578 
## 
##                coef exp(coef)  se(coef)      z
## D$age      0.042145  1.043045  0.003086 13.655
## D$female1 -0.599238  0.549230  0.084305 -7.108
##           Pr(&gt;|z|)    
## D$age      &lt; 2e-16 ***
## D$female1 1.18e-12 ***
## ---
## Signif. codes:  
## 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
##           exp(coef) exp(-coef) lower .95 upper .95
## D$age        1.0430     0.9587    1.0368    1.0494
## D$female1    0.5492     1.8207    0.4656    0.6479
## 
## Concordance= 0.699  (se = 0.011 )
## Likelihood ratio test= 227.9  on 2 df,   p=&lt;2e-16
## Wald test            = 228.4  on 2 df,   p=&lt;2e-16
## Score (logrank) test = 229.4  on 2 df,   p=&lt;2e-16</code></pre>
</div>
<div id="summary-of-survival-objects" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> Summary of survival objects</h2>
<p>We can also summarize a server-side object of type <em>survival::Surv()</em>
using a call to <em>ds.coxphSummary()</em>. This will provide a non-disclosive
summary of the server-side object. The server-side survival object can be created using ds.coxphSLMAassign().
An example call is shown below:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="computational-workflow.html#cb18-1" aria-hidden="true" tabindex="-1"></a>dsSurvivalClient<span class="sc">::</span><span class="fu">ds.coxphSummary</span>(<span class="at">x =</span> <span class="st">&#39;coxph_serverside&#39;</span>)</span></code></pre></div>
</div>
<div id="meta-analyze-hazard-ratios" class="section level2" number="3.5">
<h2><span class="header-section-number">3.5</span> Meta-analyze hazard ratios</h2>
<p>We now outline how the hazard ratios from the survival models are meta-analyzed.
We use the <em>metafor</em> package for meta-analysis. We show the summary of an
example meta-analysis and a forest plot below. The forest plot shows a basic
example of meta-analyzed hazard ratios from a survival model (analyzed in dsSurvivalClient).</p>
<p>The log-hazard ratios and their standard errors from each study can be
found after running <em>ds.coxphSLMA()</em></p>
<p>The hazard ratios can then be meta-analyzed by running the commands shown below.
These commands get the hazard ratios correspondng to age in the survival model.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="computational-workflow.html#cb19-1" aria-hidden="true" tabindex="-1"></a>input_logHR <span class="ot">=</span> <span class="fu">c</span>(coxph_model_full<span class="sc">$</span>server1<span class="sc">$</span>coefficients[<span class="dv">1</span>,<span class="dv">2</span>], </span>
<span id="cb19-2"><a href="computational-workflow.html#cb19-2" aria-hidden="true" tabindex="-1"></a>        coxph_model_full<span class="sc">$</span>server2<span class="sc">$</span>coefficients[<span class="dv">1</span>,<span class="dv">2</span>], </span>
<span id="cb19-3"><a href="computational-workflow.html#cb19-3" aria-hidden="true" tabindex="-1"></a>        coxph_model_full<span class="sc">$</span>server3<span class="sc">$</span>coefficients[<span class="dv">1</span>,<span class="dv">2</span>])</span>
<span id="cb19-4"><a href="computational-workflow.html#cb19-4" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-5"><a href="computational-workflow.html#cb19-5" aria-hidden="true" tabindex="-1"></a>input_se    <span class="ot">=</span> <span class="fu">c</span>(coxph_model_full<span class="sc">$</span>server1<span class="sc">$</span>coefficients[<span class="dv">1</span>,<span class="dv">3</span>], </span>
<span id="cb19-6"><a href="computational-workflow.html#cb19-6" aria-hidden="true" tabindex="-1"></a>        coxph_model_full<span class="sc">$</span>server2<span class="sc">$</span>coefficients[<span class="dv">1</span>,<span class="dv">3</span>], </span>
<span id="cb19-7"><a href="computational-workflow.html#cb19-7" aria-hidden="true" tabindex="-1"></a>        coxph_model_full<span class="sc">$</span>server3<span class="sc">$</span>coefficients[<span class="dv">1</span>,<span class="dv">3</span>])</span>
<span id="cb19-8"><a href="computational-workflow.html#cb19-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-9"><a href="computational-workflow.html#cb19-9" aria-hidden="true" tabindex="-1"></a>meta_model <span class="ot">&lt;-</span> metafor<span class="sc">::</span><span class="fu">rma</span>(input_logHR, <span class="at">sei =</span> input_se, <span class="at">method =</span> <span class="st">&#39;REML&#39;</span>)</span></code></pre></div>
<p>A summary of this meta-analyzed model is shown below.</p>
<pre><code>## 
## Random-Effects Model (k = 3; tau^2 estimator: REML)
## 
##   logLik  deviance       AIC       BIC      AICc 
##   9.3824  -18.7648  -14.7648  -17.3785   -2.7648   
## 
## tau^2 (estimated amount of total heterogeneity): 0 (SE = 0.0000)
## tau (square root of estimated tau^2 value):      0
## I^2 (total heterogeneity / total variability):   0.00%
## H^2 (total variability / sampling variability):  1.00
## 
## Test for Heterogeneity:
## Q(df = 2) = 0.0880, p-val = 0.9569
## 
## Model Results:
## 
## estimate      se      zval    pval   ci.lb   ci.ub 
##   1.0425  0.0020  515.4456  &lt;.0001  1.0385  1.0465  *** 
## 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>We now show a forest plot with the meta-analyzed hazard ratios. The hazard ratios come
from the dsSurvivalClient function <em>ds.coxphSLMA()</em>. The plot shows the coefficients for age in the survival model.
The command is shown below.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="computational-workflow.html#cb21-1" aria-hidden="true" tabindex="-1"></a>metafor<span class="sc">::</span><span class="fu">forest.rma</span>(<span class="at">x =</span> meta_model, <span class="at">digits =</span> <span class="dv">4</span>) </span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-21"></span>
<img src="survival_bookdown_files/figure-html/unnamed-chunk-21-1.png" alt="Example forest plot of meta-analyzed hazard ratios." width="672" />
<p class="caption">
Figure 3.1: Example forest plot of meta-analyzed hazard ratios.
</p>
</div>
<p>Finally, once you have finished your analysis, you can disconnect from the server(s) using the following command:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="computational-workflow.html#cb22-1" aria-hidden="true" tabindex="-1"></a>DSI<span class="sc">::</span><span class="fu">datashield.logout</span>(<span class="at">conns =</span> connections)</span></code></pre></div>
<div style="page-break-after: always;"></div>
<ul>
<li><p><a href="https://github.com/datashield" class="uri">https://github.com/datashield</a></p></li>
<li><p><a href="http://www.metafor-project.org" class="uri">http://www.metafor-project.org</a></p></li>
<li><p><a href="https://github.com/neelsoumya/dsSurvival" class="uri">https://github.com/neelsoumya/dsSurvival</a></p></li>
<li><p><a href="https://github.com/neelsoumya/dsSurvivalClient" class="uri">https://github.com/neelsoumya/dsSurvivalClient</a></p></li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="intro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="summary.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["survival_bookdown.pdf", "survival_bookdown.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
